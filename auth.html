<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AnimeHub - Auth</title>

  <style>
    :root {
	  --bg: #0f1724;
	  --glass: rgba(255,255,255,0.05);
	  --accent: #06b6d4;
	  --accent-hover: #0ea5e9;
	  --muted: #9ca3af;
	}

	body {
	  margin: 0;
	  height: 100vh;
	  display: flex;
	  justify-content: center;
	  align-items: center;
	  background: linear-gradient(180deg, #0b1220 0%, #061226 100%);
	  font-family: Inter, sans-serif;
	  color: #e6eef6;
	  overflow: hidden;
	}

	#authBox {
	  background: var(--glass);
	  padding: 40px 30px;
	  border-radius: 18px;
	  width: 320px;
	  text-align: center;
	  display: flex;
	  flex-direction: column;
	  gap: 16px;
	  box-shadow: 0 10px 30px rgba(6,182,212,0.3);
	  backdrop-filter: blur(10px);
	  transition: transform 0.3s ease, box-shadow 0.3s ease;
	}
	#authBox:hover {
	  transform: translateY(-4px);
	  box-shadow: 0 15px 40px rgba(6,182,212,0.5);
	}

	h2 {
	  margin: 0;
	  font-size: 24px;
	  font-weight: 700;
	  color: #e6eef6;
	}

	input {
	  padding: 12px;
	  border-radius: 12px;
	  border: 1px solid rgba(255,255,255,0.15);
	  background: rgba(255,255,255,0.08);
	  color: #e6eef6;
	  font-size: 14px;
	  outline: none;
	  transition: 0.3s all ease;
	}
	input:focus {
	  border-color: var(--accent);
	  box-shadow: 0 0 12px var(--accent);
	}

	button {
	  padding: 12px;
	  border-radius: 12px;
	  font-weight: 700;
	  font-size: 14px;
	  border: none;
	  cursor: pointer;
	  transition: all 0.25s ease;
	  box-shadow: 0 4px 14px rgba(6,182,212,0.35);
	}

	#authSubmit {
	  background: var(--accent);
	  color: #052226;
	}
	#authSubmit:hover {
	  background: var(--accent-hover);
	  box-shadow: 0 8px 22px rgba(6,182,212,0.55);
	  transform: translateY(-2px);
	}

	#switchMode {
	  background: transparent;
	  color: var(--accent);
	  border: 1px solid rgba(6,182,212,0.5);
	}
	#switchMode:hover {
	  background: rgba(6,182,212,0.1);
	  transform: translateY(-2px);
	}

	@media (max-width: 400px) {
	  #authBox {
		width: 90%;
		padding: 30px 20px;
	  }
	}

  </style>
  <!-- Favicon classique -->
  <link rel="icon" type="image/png" href="icon_animehub.png">
  <!-- Icône Apple touch (pour iPhone/iPad) -->
  <link rel="apple-touch-icon" sizes="180x180" href="icon_animehub.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icon_animehub.png">
  <link rel="apple-touch-icon" sizes="120x120" href="icon_animehub.png">
  <link rel="apple-touch-icon" sizes="76x76" href="icon_animehub.png">
</head>

<body>

  <div id="authBox">
    <h2 id="authTitle">Connexion</h2>

    <input id="authEmail" type="email" placeholder="Email">
    <input id="authPassword" type="password" placeholder="Mot de passe">

    <button id="authSubmit">Valider</button>

    <button id="switchMode">Pas de compte ? Inscription</button>
  </div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { 
	getAuth, 
	onAuthStateChanged, 
	signInWithEmailAndPassword, 
	createUserWithEmailAndPassword 
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  import { 
	getFirestore, 
	doc, 
	setDoc,
	serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
	apiKey: "AIzaSyCaJZi1Bn1vbeKOC5cM3Gi6nOFyWaH4NK4",
	authDomain: "animehub-7.firebaseapp.com",
	projectId: "animehub-7",
	storageBucket: "animehub-7.firebasestorage.app",
	messagingSenderId: "159114039206",
	appId: "1:159114039206:web:0461d676e7ffff25c4c967",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const authTitle = document.getElementById("authTitle");
  const switchBtn = document.getElementById("switchMode");
  const submitBtn = document.getElementById("authSubmit");

  let mode = "login";

  switchBtn.addEventListener("click", () => {
	if (mode === "login") {
	  mode = "signup";
	  authTitle.textContent = "Inscription";
	  switchBtn.textContent = "Déjà un compte ? Connexion";
	} else {
	  mode = "login";
	  authTitle.textContent = "Connexion";
	  switchBtn.textContent = "Pas de compte ? Inscription";
	}
  });

  submitBtn.addEventListener("click", async () => {
	const email = document.getElementById("authEmail").value;
	const password = document.getElementById("authPassword").value;

	try {
	  if (mode === "login") {
		await signInWithEmailAndPassword(auth, email, password);
		console.log("Utilisateur connecté :", email);

	  } else {
		const cred = await createUserWithEmailAndPassword(auth, email, password);
		console.log("Compte créé avec succès :", cred.user.uid);

		try {
		  const userDoc = doc(db, "users", cred.user.uid);

		  await setDoc(userDoc, {
			username: email.split("@")[0],
			email: email,
			favorites: [],
			ratings: {},
			createdAt: serverTimestamp
		  });

		  console.log("Utilisateur ajouté à Firestore !");
		  alert("Compte créé et enregistré dans Firestore !");

		} catch(firestoreErr) {
		  console.error("Erreur Firestore :", firestoreErr);
		  alert("Le compte a été créé, mais impossible d'enregistrer les données supplémentaires.");
		}
	  }

	  window.location.href = "index.html";

	} catch (err) {
	  console.error("Erreur Auth :", err);
	  alert("Erreur : " + err.message);
	}
  });
  document.addEventListener("keydown", (e) => {
    if (e.key === "Enter") submitBtn.click();
  });

  let checkedAuth = false;

  onAuthStateChanged(auth, (user) => {
    if (user && !checkedAuth) {
      checkedAuth = true;
      window.location.href = "index.html";
    }
  });
  </script>
</body>
</html>
