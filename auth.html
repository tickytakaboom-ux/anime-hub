<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AnimeHub - Auth</title>

  <style>
    :root {
	  --bg: #0f1724;
	  --glass: rgba(255,255,255,0.05);
	  --accent: #06b6d4;
	  --accent-hover: #0ea5e9;
	  --muted: #9ca3af;
	}

	body {
	  margin: 0;
	  height: 100vh;
	  display: flex;
	  justify-content: center;
	  align-items: center;
	  background: linear-gradient(180deg, #0b1220 0%, #061226 100%);
	  font-family: Inter, sans-serif;
	  color: #e6eef6;
	  overflow: hidden;
	}

	#authBox {
	  background: var(--glass);
	  padding: 40px 30px;
	  border-radius: 18px;
	  width: 320px;
	  text-align: center;
	  display: flex;
	  flex-direction: column;
	  gap: 16px;
	  box-shadow: 0 10px 30px rgba(6,182,212,0.3);
	  backdrop-filter: blur(10px);
	  transition: transform 0.3s ease, box-shadow 0.3s ease;
	}
	#authBox:hover {
	  transform: translateY(-4px);
	  box-shadow: 0 15px 40px rgba(6,182,212,0.5);
	}

	h2 {
	  margin: 0;
	  font-size: 24px;
	  font-weight: 700;
	  color: #e6eef6;
	}

	.subtitle {
	  margin: -6px 0 6px;
	  color: var(--muted);
	  font-size: 13px;
	}

	form {
	  display: flex;
	  flex-direction: column;
	  gap: 14px;
	}

	.field {
	  display: flex;
	  flex-direction: column;
	  gap: 8px;
	  text-align: left;
	}

	label {
	  font-size: 13px;
	  color: var(--muted);
	}

	input {
	  padding: 12px;
	  border-radius: 12px;
	  border: 1px solid rgba(255,255,255,0.15);
	  background: rgba(255,255,255,0.08);
	  color: #e6eef6;
	  font-size: 14px;
	  outline: none;
	  transition: 0.3s all ease;
	}
	input:focus {
	  border-color: var(--accent);
	  box-shadow: 0 0 12px var(--accent);
	}

	.input-row {
	  display: flex;
	  align-items: center;
	  gap: 8px;
	}

	.toggle-password {
	  background: transparent;
	  border: 1px solid rgba(255,255,255,0.2);
	  color: #e6eef6;
	  padding: 10px;
	  border-radius: 10px;
	  font-size: 12px;
	  cursor: pointer;
	  box-shadow: none;
	}

	button {
	  padding: 12px;
	  border-radius: 12px;
	  font-weight: 700;
	  font-size: 14px;
	  border: none;
	  cursor: pointer;
	  transition: all 0.25s ease;
	  box-shadow: 0 4px 14px rgba(6,182,212,0.35);
	}

	button:disabled {
	  cursor: not-allowed;
	  opacity: 0.7;
	  transform: none;
	  box-shadow: none;
	}

	#authSubmit {
	  background: var(--accent);
	  color: #052226;
	}
	
	#authSubmit:hover {
	  background: var(--accent-hover);
	  box-shadow: 0 8px 22px rgba(6,182,212,0.55);
	  transform: translateY(-2px);
	}

	#switchMode {
	  background: transparent;
	  color: var(--accent);
	  border: 1px solid rgba(6,182,212,0.5);
	}
	#switchMode:hover {
	  background: rgba(6,182,212,0.1);
	  transform: translateY(-2px);
	}

	.helper {
	  font-size: 12px;
	  color: var(--muted);
	}

	.error {
	  font-size: 13px;
	  color: #f87171;
	  min-height: 18px;
	}

	.success {
	  color: #34d399;
	}

	:focus-visible {
	  outline: 2px solid rgba(6,182,212,0.8);
	  outline-offset: 2px;
	}

	@media (max-width: 400px) {
	  #authBox {
		width: 90%;
		padding: 30px 20px;
	  }
	}
  </style>
  <!-- Favicon classique -->
  <link rel="icon" type="image/png" href="icon_animehub.png">
  <!-- Icône Apple touch (pour iPhone/iPad) -->
  <link rel="apple-touch-icon" sizes="180x180" href="icon_animehub.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icon_animehub.png">
  <link rel="apple-touch-icon" sizes="120x120" href="icon_animehub.png">
  <link rel="apple-touch-icon" sizes="76x76" href="icon_animehub.png">
</head>

<body>

  <div id="authBox">
    <h2 id="authTitle">Connexion</h2>
	<p class="subtitle" id="authSubtitle">Ravi de te revoir sur AnimeHub</p>

	<form id="authForm">
	  <div class="field">
	    <label for="authEmail">Email</label>
	    <input id="authEmail" type="email" placeholder="ex: naruto@animehub.com" autocomplete="email" required>
	  </div>
	  <div class="field">
	    <label for="authPassword">Mot de passe</label>
	    <div class="input-row">
	      <input id="authPassword" type="password" placeholder="••••••••" autocomplete="current-password" required>
	      <button class="toggle-password" id="togglePassword" type="button">Afficher</button>
	    </div>
	    <span class="helper" id="passwordHelper">8 caractères minimum recommandés</span>
	  </div>

	  <button id="authSubmit" type="submit">Valider</button>
	</form>

	<p class="error" id="authError" aria-live="polite"></p>

    <button id="switchMode" type="button">Pas de compte ? Inscription</button>
  </div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { 
	getAuth, 
	onAuthStateChanged, 
	signInWithEmailAndPassword, 
	createUserWithEmailAndPassword 
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
  import { 
	getFirestore, 
	doc, 
	setDoc,
	serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
	apiKey: "AIzaSyCaJZi1Bn1vbeKOC5cM3Gi6nOFyWaH4NK4",
	authDomain: "animehub-7.firebaseapp.com",
	projectId: "animehub-7",
	storageBucket: "animehub-7.firebasestorage.app",
	messagingSenderId: "159114039206",
	appId: "1:159114039206:web:0461d676e7ffff25c4c967",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const authTitle = document.getElementById("authTitle");
  const authSubtitle = document.getElementById("authSubtitle");
  const switchBtn = document.getElementById("switchMode");
  const submitBtn = document.getElementById("authSubmit");
  const authForm = document.getElementById("authForm");
  const authError = document.getElementById("authError");
  const togglePassword = document.getElementById("togglePassword");
  const passwordInput = document.getElementById("authPassword");
  const passwordHelper = document.getElementById("passwordHelper");
  const emailInput = document.getElementById("authEmail");

  let mode = "login";

  switchBtn.addEventListener("click", () => {
	if (mode === "login") {
	  mode = "signup";
	  authTitle.textContent = "Inscription";
	  authSubtitle.textContent = "Crée ton compte pour sauvegarder tes favoris.";
	  switchBtn.textContent = "Déjà un compte ? Connexion";
	  passwordInput.autocomplete = "new-password";
	  passwordHelper.textContent = "Choisis un mot de passe sécurisé.";
	} else {
	  mode = "login";
	  authTitle.textContent = "Connexion";
	  authSubtitle.textContent = "Ravi de te revoir sur AnimeHub.";
	  switchBtn.textContent = "Pas de compte ? Inscription";
	  passwordInput.autocomplete = "current-password";
	  passwordHelper.textContent = "8 caractères minimum recommandés.";
	}
	authError.textContent = "";
	authError.classList.remove("success");
  });

  togglePassword.addEventListener("click", () => {
	const isHidden = passwordInput.type === "password";
	passwordInput.type = isHidden ? "text" : "password";
	togglePassword.textContent = isHidden ? "Masquer" : "Afficher";
  });

  authForm.addEventListener("submit", async (event) => {
	event.preventDefault();
	authError.textContent = "";
	authError.classList.remove("success");
	submitBtn.disabled = true;
	submitBtn.textContent = "Chargement...";

	const email = emailInput.value.trim();
	const password = passwordInput.value;

	try {
	  if (mode === "login") {
		await signInWithEmailAndPassword(auth, email, password);
		console.log("Utilisateur connecté :", email);

	  } else {
		const cred = await createUserWithEmailAndPassword(auth, email, password);
		console.log("Compte créé avec succès :", cred.user.uid);

		try {
		  const userDoc = doc(db, "users", cred.user.uid);

		  await setDoc(userDoc, {
			username: email.split("@")[0],
			email: email,
			favorites: [],
			ratings: {},
			createdAt: serverTimestamp()
		  });

		  console.log("Utilisateur ajouté à Firestore !");
		  authError.textContent = "Compte créé et enregistré dans Firestore !";
		  authError.classList.add("success");

		} catch(firestoreErr) {
		  console.error("Erreur Firestore :", firestoreErr);
		  authError.textContent = "Le compte a été créé, mais impossible d'enregistrer les données supplémentaires.";
		}
	  }

	  window.location.href = "index.html";

	} catch (err) {
	  console.error("Erreur Auth :", err);
	  authError.textContent = "Erreur : " + err.message;
	  authError.classList.remove("success");
	} finally {
	  submitBtn.disabled = false;
	  submitBtn.textContent = "Valider";
	}
  });

  let checkedAuth = false;

  onAuthStateChanged(auth, (user) => {
    if (user && !checkedAuth) {
      checkedAuth = true;
      window.location.href = "index.html";
    }
  });
  </script>
</body>
</html>
